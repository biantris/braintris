"use strict";(self.webpackChunkbraintris=self.webpackChunkbraintris||[]).push([[6769],{450:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"database/mongoDB/query-optimization","title":"Query Optimization","description":"Query optimization in MongoDB","source":"@site/docs/database/mongoDB/query-optimization.md","sourceDirName":"database/mongoDB","slug":"/database/mongoDB/query-optimization","permalink":"/braintris/en/docs/database/mongoDB/query-optimization","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"query-optimization","permalink":"/braintris/en/docs/tags/query-optimization"},{"inline":true,"label":"mongoDB","permalink":"/braintris/en/docs/tags/mongo-db"},{"inline":true,"label":"content","permalink":"/braintris/en/docs/tags/content"},{"inline":true,"label":"notes","permalink":"/braintris/en/docs/tags/notes"},{"inline":true,"label":"wip","permalink":"/braintris/en/docs/tags/wip"},{"inline":true,"label":"pt-BR","permalink":"/braintris/en/docs/tags/pt-br"}],"version":"current","lastUpdatedBy":"biantris","lastUpdatedAt":1771470241000,"frontMatter":{"id":"query-optimization","title":"Query Optimization","tags":["query-optimization","mongoDB","content","notes","wip","pt-BR"]},"sidebar":"tutorialSidebar","previous":{"title":"MongoDB","permalink":"/braintris/en/docs/category/mongodb"},"next":{"title":"Relay","permalink":"/braintris/en/docs/category/relay"}}');var a=o(4848),t=o(8453);const r={id:"query-optimization",title:"Query Optimization",tags:["query-optimization","mongoDB","content","notes","wip","pt-BR"]},s=void 0,d={},l=[{value:"Query optimization in MongoDB",id:"query-optimization-in-mongodb",level:3},{value:"Criar um \xedndice para dar suporte a opera\xe7\xf5es de leitura",id:"criar-um-\xedndice-para-dar-suporte-a-opera\xe7\xf5es-de-leitura",level:3},{value:"Range Query",id:"range-query",level:3},{value:"Equality Plus Range Query",id:"equality-plus-range-query",level:3}];function c(e){const n={a:"a",code:"code",em:"em",h3:"h3",li:"li",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h3,{id:"query-optimization-in-mongodb",children:"Query optimization in MongoDB"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"indexes"}),":"]}),"\n",(0,a.jsx)(n.li,{children:"single field index: when filtering by a single field"}),"\n",(0,a.jsx)(n.li,{children:"compound field index: when filtering by many fields at the same time"}),"\n",(0,a.jsx)(n.li,{children:"multikey index: array fields"}),"\n",(0,a.jsx)(n.li,{children:"text index: full-text search in many fields in same collection"}),"\n",(0,a.jsx)(n.li,{children:"wildcard index: to handle metadata, schemaless design, filter for fields that you don't know yet"}),"\n",(0,a.jsx)(n.li,{children:"geospatial index: to filter by location, near, intersection and more"}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"batching queries"}),(0,a.jsx)("br",{}),"\n",(0,a.jsx)(n.a,{href:"https://twitter.com/sseraphini/status/1271150022483214338",children:"https://twitter.com/sseraphini/status/1271150022483214338"})]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://www.mongodb.com/docs/manual/core/query-optimization/",children:"https://www.mongodb.com/docs/manual/core/query-optimization/"})," ",(0,a.jsx)("br",{}),"\n",(0,a.jsx)(n.strong,{children:"notes:"}),"\nOs \xedndices melhoram a efici\xeancia das opera\xe7\xf5es de leitura reduzindo a quantidade de dados que as opera\xe7\xf5es de consulta precisam processar. Isso simplifica o trabalho associado ao preencimento de consultas no mongoDB."]}),"\n",(0,a.jsx)(n.h3,{id:"criar-um-\xedndice-para-dar-suporte-a-opera\xe7\xf5es-de-leitura",children:"Criar um \xedndice para dar suporte a opera\xe7\xf5es de leitura"}),"\n",(0,a.jsxs)(n.p,{children:["Se seu aplicativo consultar uma cole\xe7\xe3o em um determinado campo ou conjunto de campos, um \xedndice no campo consultado ou um \xedndice composto no conjunto de campos pode impedir que a consulta verifique toda a cole\xe7\xe3o para localizar e retornar os resultados da consulta.",(0,a.jsx)("br",{}),"\n",(0,a.jsx)(n.a,{href:"https://emptysqua.re/blog/optimizing-mongodb-compound-indexes/",children:"https://emptysqua.re/blog/optimizing-mongodb-compound-indexes/"})]}),"\n",(0,a.jsx)(n.h3,{id:"range-query",children:"Range Query"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"BasicCursor:"})," significa que o mongoDB teve que fazer uma varredura completa pela cole\xe7\xe3o. Isso n\xe3o funcionar\xe1 quando tiver milh\xf5es de dados, iria ficar bastante lento, ent\xe3o \xe9 recomendado adicionar um \xedndice ao campo pesquisado."]}),"\n",(0,a.jsx)(n.p,{children:'BtreeCursor + nome do \xedndice: o "nscanned" caiu de 4 para 3, porque o mongo usou um \xedndice para ir diretamente aos documentos necess\xe1rios, pulando aquele cujo timestamp est\xe1 fora do intervalo.'}),"\n",(0,a.jsxs)(n.p,{children:["Para consultas indexadas, ",(0,a.jsx)(n.code,{children:"nscanned \xe9 o n\xfamero de\xa0_chaves de \xedndice_\xa0no intervalo que o Mongo escaneou"})," e ",(0,a.jsx)(n.code,{children:"nscannedObjects"})," \xe9 o n\xfamero de\xa0",(0,a.jsx)(n.em,{children:"documentos"}),"\xa0que foram examinados para chegar ao resultado final."]}),"\n",(0,a.jsx)(n.p,{children:"nscanned >= nscannedObjects >= n\nnscanned = nscannedObjects = n"}),"\n",(0,a.jsx)(n.p,{children:"Para consultas simples, voc\xea deseja que os tr\xeas n\xfameros sejam iguais.\xa0Isso significa que voc\xea criou o \xedndice ideal e o Mongo o est\xe1 usando."}),"\n",(0,a.jsx)(n.h3,{id:"equality-plus-range-query",children:"Equality Plus Range Query"}),"\n",(0,a.jsx)(n.p,{children:'A ordem \xe9 importante nos \xedndices compostos do MongoDB, como em qualquer banco de dados.\xa0Se eu fizer um \xedndice com "an\xf4nimo" primeiro, o Mongo pode pular direto para a se\xe7\xe3o do \xedndice com coment\xe1rios assinados e, em seguida, fazer uma varredura de intervalo do timestamp 2 a 4.'}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"testes de igualdade antes dos filtros de intervalo"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:'Vamos considerar se valeu a pena incluir "an\xf4nimo" no \xedndice.\xa0Em um sistema com milh\xf5es de coment\xe1rios e milh\xf5es de consultas por dia, reduzir o nscanned pode melhorar consideravelmente o rendimento.'})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>s});var i=o(6540);const a={},t=i.createContext(a);function r(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);